var d=Object.defineProperty;var m=(n,e,t)=>e in n?d(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>m(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function h(n,e,t={}){const{maxTicks:s=100,actions:i=[]}=t;return{id:n,name:e,ticks:s,maxTicks:s,actions:[...i]}}function l(n,e){return n.ticks>=e.tickCost}function g(n,e){n.ticks=Math.min(n.ticks+e,n.maxTicks)}function f(n,e){return n.ticks<e?!1:(n.ticks-=e,!0)}const p={id:"idle",name:"Idle",description:"Rest and recover ticks.",tickCost:0,tickGain:5,tags:["basic","recovery"],execute:n=>({success:!0,message:"You rest, recovering 5 ticks."})},y={id:"wander",name:"Wander",description:"Wander aimlessly, perhaps discovering something.",tickCost:3,tags:["basic","exploration","movement"],execute:n=>{const e=["You wander through familiar paths.","You explore a quiet corner.","You meander without purpose, but feel refreshed.","Your wandering reveals nothing new, but clears your mind."];return{success:!0,message:e[Math.floor(Math.random()*e.length)]}}},k=[p,y],A=100;function v(){return h("player","Player",{maxTicks:A,actions:k})}class L{constructor(){c(this,"state");c(this,"listeners",new Map);this.state={player:v(),turn:0,log:[]}}start(){this.log("Welcome to Iterra.")}performAction(e){const t=this.state.player;if(!l(t,e))return this.log(`Not enough ticks for ${e.name}. Need ${e.tickCost}, have ${t.ticks}.`),!1;f(t,e.tickCost),e.tickGain&&g(t,e.tickGain);const s=e.execute(t);return this.state.turn++,this.log(s.message),this.emit("turn"),!0}log(e){const t={turn:this.state.turn,message:e};this.state.log.unshift(t),this.state.log.length>100&&this.state.log.pop(),this.emit("log")}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){var s;(s=this.listeners.get(e))==null||s.delete(t)}emit(e){var t;(t=this.listeners.get(e))==null||t.forEach(s=>s(this))}getAvailableActions(){return this.state.player.actions}filterActions(e){const t=e.toLowerCase().trim();return t?this.getAvailableActions().filter(s=>{const i=s.name.toLowerCase().includes(t),r=s.description.toLowerCase().includes(t),o=s.tags.some(u=>u.toLowerCase().includes(t));return i||r||o}):this.getAvailableActions()}}class b{constructor(e){c(this,"game");c(this,"elements");this.game=e,this.elements={tickCount:document.getElementById("tick-count"),turnCount:document.getElementById("turn-count"),actionSearch:document.getElementById("action-search"),actionsList:document.getElementById("actions-list"),gameLog:document.getElementById("game-log")},this.setupEventListeners(),this.subscribeToGame()}setupEventListeners(){this.elements.actionSearch.addEventListener("input",()=>{this.renderActions()}),document.addEventListener("keydown",e=>{e.key==="/"&&document.activeElement!==this.elements.actionSearch&&(e.preventDefault(),this.elements.actionSearch.focus()),e.key==="Escape"&&(this.elements.actionSearch.blur(),this.elements.actionSearch.value="",this.renderActions())})}subscribeToGame(){this.game.on("turn",()=>{this.renderStatus(),this.renderActions()}),this.game.on("log",()=>this.renderLog())}render(){this.renderStatus(),this.renderActions(),this.renderLog()}renderStatus(){const e=this.game.state.player;this.elements.tickCount.textContent=e.ticks.toString(),this.elements.turnCount.textContent=this.game.state.turn.toString()}renderActions(){const e=this.elements.actionSearch.value,t=this.game.filterActions(e);this.elements.actionsList.innerHTML=t.map(s=>this.renderActionItem(s)).join(""),this.elements.actionsList.querySelectorAll(".action-item").forEach(s=>{const i=s.getAttribute("data-action-id"),r=t.find(o=>o.id===i);r&&s.addEventListener("click",()=>this.handleActionClick(r))})}renderActionItem(e){const t=this.game.state.player,s=l(t,e),i=e.tickGain?`+${e.tickGain} ticks`:`${e.tickCost} ticks`;return`
      <div class="action-item ${s?"":"disabled"}" data-action-id="${e.id}">
        <div class="action-info">
          <span class="action-name">${e.name}</span>
        </div>
        <span class="action-cost ${s?"affordable":""}">${i}</span>
      </div>
    `}handleActionClick(e){this.game.performAction(e)}renderLog(){const e=this.game.state.log.slice(0,20);this.elements.gameLog.innerHTML=e.map(t=>`
        <div class="log-entry">
          <span class="timestamp">[${t.turn}]</span>
          ${t.message}
        </div>
      `).join("")}}const a=new L,C=new b(a);C.render();a.start();window.game=a;
