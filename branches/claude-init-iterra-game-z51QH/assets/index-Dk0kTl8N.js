var d=Object.defineProperty;var m=(n,e,t)=>e in n?d(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>m(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function h(n,e,t={}){const{maxTicks:i=1e4,speed:s=100,actions:r=[]}=t;return{id:n,name:e,ticks:i,maxTicks:i,speed:s,actions:[...r]}}function l(n,e){return n.ticks>=e.tickCost}function g(n,e){n.ticks=Math.min(n.ticks+e,n.maxTicks)}function f(n,e){return n.ticks<e?!1:(n.ticks-=e,!0)}const p={id:"idle",name:"Idle",description:"Rest and recover ticks.",tickCost:100,tickGain:200,tags:["basic","recovery"],execute:n=>({success:!0,message:"You rest, recovering some energy."})},y={id:"wander",name:"Wander",description:"Wander aimlessly, perhaps discovering something.",tickCost:300,tags:["basic","exploration","movement"],execute:n=>{const e=["You wander through familiar paths.","You explore a quiet corner.","You meander without purpose, but feel refreshed.","Your wandering reveals nothing new, but clears your mind."];return{success:!0,message:e[Math.floor(Math.random()*e.length)]}}},k=[p,y],A=1e4,L=100;function v(){return h("player","Player",{maxTicks:A,speed:L,actions:k})}class C{constructor(){c(this,"state");c(this,"listeners",new Map);this.state={player:v(),turn:0,log:[]}}start(){this.log("Welcome to Iterra.")}performAction(e){const t=this.state.player;if(!l(t,e))return this.log(`Not enough ticks for ${e.name}. Need ${e.tickCost}, have ${t.ticks}.`),!1;f(t,e.tickCost),e.tickGain&&g(t,e.tickGain);const i=e.execute(t);return this.state.turn++,this.log(i.message),this.emit("turn"),!0}log(e){const t={turn:this.state.turn,message:e};this.state.log.unshift(t),this.state.log.length>100&&this.state.log.pop(),this.emit("log")}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){var i;(i=this.listeners.get(e))==null||i.delete(t)}emit(e){var t;(t=this.listeners.get(e))==null||t.forEach(i=>i(this))}getAvailableActions(){return this.state.player.actions}filterActions(e){const t=e.toLowerCase().trim();return t?this.getAvailableActions().filter(i=>{const s=i.name.toLowerCase().includes(t),r=i.description.toLowerCase().includes(t),o=i.tags.some(u=>u.toLowerCase().includes(t));return s||r||o}):this.getAvailableActions()}}class b{constructor(e){c(this,"game");c(this,"elements");this.game=e,this.elements={tickCount:document.getElementById("tick-count"),turnCount:document.getElementById("turn-count"),actionSearch:document.getElementById("action-search"),actionsList:document.getElementById("actions-list"),gameLog:document.getElementById("game-log")},this.setupEventListeners(),this.subscribeToGame()}setupEventListeners(){this.elements.actionSearch.addEventListener("input",()=>{this.renderActions()}),document.addEventListener("keydown",e=>{e.key==="/"&&document.activeElement!==this.elements.actionSearch&&(e.preventDefault(),this.elements.actionSearch.focus()),e.key==="Escape"&&(this.elements.actionSearch.blur(),this.elements.actionSearch.value="",this.renderActions())})}subscribeToGame(){this.game.on("turn",()=>{this.renderStatus(),this.renderActions()}),this.game.on("log",()=>this.renderLog())}render(){this.renderStatus(),this.renderActions(),this.renderLog()}renderStatus(){const e=this.game.state.player;this.elements.tickCount.textContent=e.ticks.toString(),this.elements.turnCount.textContent=this.game.state.turn.toString()}renderActions(){const e=this.elements.actionSearch.value,t=this.game.filterActions(e);this.elements.actionsList.innerHTML=t.map(i=>this.renderActionItem(i)).join(""),this.elements.actionsList.querySelectorAll(".action-item").forEach(i=>{const s=i.getAttribute("data-action-id"),r=t.find(o=>o.id===s);r&&i.addEventListener("click",()=>this.handleActionClick(r))})}renderActionItem(e){const t=this.game.state.player,i=l(t,e);let s;if(e.tickGain&&e.tickCost){const r=e.tickGain-e.tickCost;s=`${e.tickCost} cost, +${r} net`}else e.tickGain?s=`+${e.tickGain} ticks`:s=`${e.tickCost} ticks`;return`
      <div class="action-item ${i?"":"disabled"}" data-action-id="${e.id}">
        <div class="action-info">
          <span class="action-name">${e.name}</span>
        </div>
        <span class="action-cost ${i?"affordable":""}">${s}</span>
      </div>
    `}handleActionClick(e){this.game.performAction(e)}renderLog(){const e=this.game.state.log.slice(0,20);this.elements.gameLog.innerHTML=e.map(t=>`
        <div class="log-entry">
          <span class="timestamp">[${t.turn}]</span>
          ${t.message}
        </div>
      `).join("")}}const a=new C,E=new b(a);E.render();a.start();window.game=a;
