var q=Object.defineProperty;var j=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>j(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const D={berries:{id:"berries",name:"Berries",description:"Sweet, ripe berries. Can be eaten for sustenance.",stackable:!0,tags:["food","raw","foraged"],weight:.1,saturationGain:4},sticks:{id:"sticks",name:"Sticks",description:"Dry wooden sticks. Useful for crafting.",stackable:!0,tags:["material","wood","foraged"],weight:.5},rocks:{id:"rocks",name:"Rocks",description:"Sturdy rocks. Useful for crafting and building.",stackable:!0,tags:["material","stone","foraged"],weight:2},rawMeat:{id:"rawMeat",name:"Raw Meat",description:"Raw meat from a slain creature. Should be cooked before eating.",stackable:!0,tags:["food","raw","meat"],weight:1,saturationGain:2},cookedMeat:{id:"cookedMeat",name:"Cooked Meat",description:"Well-cooked meat. Nutritious and filling.",stackable:!0,tags:["food","cooked","meat"],weight:1,saturationGain:8}};function v(t){return D[t]}function O(t,e,n={}){const{maxTicks:s=1e4,speed:a=100,carryCapacity:r=30,maxHealth:o=100,damage:i=10,saturation:u=10,maxSaturation:c=20,inventory:l={},actions:h=[]}=n;return{id:t,name:e,ticks:s,maxTicks:s,speed:a,carryCapacity:r,health:o,maxHealth:o,damage:i,saturation:u,maxSaturation:c,inventory:{...l},actions:[...h]}}function b(t,e){return t.ticks>=e.tickCost}function M(t,e){t.ticks=Math.min(t.ticks+e,t.maxTicks)}function W(t,e){return t.ticks<e?!1:(t.ticks-=e,!0)}function k(t,e){t.health=Math.max(0,t.health-e)}function U(t,e){t.health=Math.min(t.maxHealth,t.health+e)}function f(t){return t.health>0}function K(t,e){t.saturation=Math.min(t.maxSaturation,t.saturation+e)}function V(t,e){t.saturation=Math.max(0,t.saturation-e)}const H=4,X=16;function z(t){return t.saturation>X}function x(t){return t.saturation<H}function J(t){return x(t)?H-t.saturation:0}function d(t,e){return t.inventory[e]??0}function C(t,e,n){t.inventory[e]=(t.inventory[e]??0)+n}function Q(t,e,n){const s=t.inventory[e]??0;return s<n?!1:(t.inventory[e]=s-n,!0)}function B(t){let e=0;for(const[n,s]of Object.entries(t.inventory))if(s>0){const a=v(n);a&&(e+=a.weight*s)}return e}function Z(t){return B(t)/t.carryCapacity}function R(t){const e=Z(t);return e<=.5?20*(1-e*2):e<=1?0:-50*(e-1)}function m(t){return Math.max(10,t.speed+R(t))}const Y={berryBush:{id:"berryBush",name:"Berry Bush",description:"A bush laden with ripe berries.",gatherActionId:"gather-berries",discoveryChance:.2,discoveryMessage:"You stumble upon a bush laden with ripe berries!",depletionChance:.6},fallenBranches:{id:"fallenBranches",name:"Fallen Branches",description:"Some fallen branches on the ground.",gatherActionId:"gather-sticks",discoveryChance:.2,discoveryMessage:"You find some fallen branches on the ground.",depletionChance:.5},rockyOutcrop:{id:"rockyOutcrop",name:"Rocky Outcrop",description:"Some useful rocks jutting from the ground.",gatherActionId:"gather-rocks",discoveryChance:.15,discoveryMessage:"You notice some useful rocks nearby.",depletionChance:.4}};function ee(t){return Y[t]}function te(){return Object.values(Y)}function ne(){const t=te();let e=0;const n=Math.random();for(const s of t)if(e+=s.discoveryChance,n<e)return s;return null}const se={campfire:{id:"campfire",name:"Build Campfire",description:"Build a campfire using sticks and rocks.",inputs:{sticks:5,rocks:3},outputs:{},tickCost:400,unlocks:"campfire"},cookedMeat:{id:"cookedMeat",name:"Cook Meat",description:"Cook raw meat on the campfire.",inputs:{rawMeat:1},outputs:{cookedMeat:1},tickCost:200,requiresCampfire:!0}};function P(t){return se[t]}function _(t,e,n){if(t.requiresCampfire&&!n.has("campfire"))return{canCraft:!1,reason:"Requires a campfire."};if(t.unlocks&&n.has(t.unlocks))return{canCraft:!1,reason:"Already built."};for(const[s,a]of Object.entries(t.inputs)){const r=e[s]??0;if(r<a)return{canCraft:!1,reason:`Need ${a} ${s}, have ${r}.`}}return{canCraft:!0}}function G(t,e){for(const[n,s]of Object.entries(t.inputs))e[n]=(e[n]??0)-s;for(const[n,s]of Object.entries(t.outputs))e[n]=(e[n]??0)+s}const ae={id:"idle",name:"Idle",description:"Rest and recover ticks.",tickCost:100,tickGain:200,tags:["basic","recovery"],execute:(t,e)=>({success:!0,message:"You rest, recovering some energy."})},re={id:"wander",name:"Wander",description:"Wander aimlessly, perhaps discovering something.",tickCost:300,tags:["basic","exploration","movement","non-combat"],execute:(t,e)=>{const n=ne();if(n)return{success:!0,message:n.discoveryMessage,foundResource:n.id};const s=["You wander through familiar paths.","You explore a quiet corner.","You meander without purpose, but feel refreshed.","Your wandering reveals nothing new, but clears your mind."];return{success:!0,message:s[Math.floor(Math.random()*s.length)]}}},oe={id:"gather-berries",name:"Gather Berries",description:"Pick berries from the bush.",tickCost:150,tags:["gathering","non-combat"],execute:(t,e)=>{const n=2+Math.floor(Math.random()*3);return C(t,"berries",n),{success:!0,message:`You gather ${n} berries. (${d(t,"berries")} total)`}}},ie={id:"gather-sticks",name:"Gather Sticks",description:"Collect sticks from the ground.",tickCost:100,tags:["gathering","non-combat"],execute:(t,e)=>{const n=2+Math.floor(Math.random()*3);return C(t,"sticks",n),{success:!0,message:`You gather ${n} sticks. (${d(t,"sticks")} total)`}}},ce={id:"gather-rocks",name:"Gather Rocks",description:"Collect rocks from the ground.",tickCost:120,tags:["gathering","non-combat"],execute:(t,e)=>{const n=1+Math.floor(Math.random()*2);return C(t,"rocks",n),{success:!0,message:`You gather ${n} rocks. (${d(t,"rocks")} total)`}}},ue={id:"build-campfire",name:"Build Campfire",description:"Build a campfire using sticks and rocks. (5 sticks, 3 rocks)",tickCost:400,tags:["crafting","non-combat"],execute:(t,e)=>{var o;const n=P("campfire"),s=((o=e==null?void 0:e.game)==null?void 0:o.structures)??new Set,{canCraft:a,reason:r}=_(n,t.inventory,s);return a?(G(n,t.inventory),e!=null&&e.game&&n.unlocks&&e.game.structures.add(n.unlocks),{success:!0,message:"You build a campfire. You can now cook meat!"}):{success:!1,message:r}}},le={id:"cook-meat",name:"Cook Meat",description:"Cook raw meat on the campfire.",tickCost:200,tags:["crafting","non-combat"],execute:(t,e)=>{var o;const n=P("cookedMeat"),s=((o=e==null?void 0:e.game)==null?void 0:o.structures)??new Set,{canCraft:a,reason:r}=_(n,t.inventory,s);return a?(G(n,t.inventory),{success:!0,message:`You cook the meat. (${d(t,"cookedMeat")} cooked meat)`}):{success:!1,message:r}}};function S(t,e,n,s){var r;const a=v(t);return{id:e,name:n,description:`Eat ${((r=a==null?void 0:a.name)==null?void 0:r.toLowerCase())??t} to restore saturation.`,tickCost:s,tags:["consumption","non-combat"],execute:(o,i)=>{var l,h;if(d(o,t)<=0)return{success:!1,message:`You have no ${((l=a==null?void 0:a.name)==null?void 0:l.toLowerCase())??t} to eat.`};Q(o,t,1);const c=(a==null?void 0:a.saturationGain)??1;return K(o,c),{success:!0,message:`You eat the ${((h=a==null?void 0:a.name)==null?void 0:h.toLowerCase())??t}. (+${c} saturation, ${o.saturation}/${o.maxSaturation})`}}}}const me=S("berries","eat-berries","Eat Berries",50),he=S("cookedMeat","eat-cooked-meat","Eat Cooked Meat",75),de=S("rawMeat","eat-raw-meat","Eat Raw Meat",50),fe={id:"attack",name:"Attack",description:"Strike your enemy.",tickCost:200,tags:["combat","offensive"],execute:(t,e)=>{if(!(e!=null&&e.encounter))return{success:!1,message:"Nothing to attack."};const n=e.encounter.enemy,s=t.damage;return k(n,s),f(n)?{success:!0,message:`You strike the ${n.name} for ${s} damage. (${n.health}/${n.maxHealth} HP)`}:{success:!0,message:`You strike the ${n.name} for ${s} damage, defeating it!`,encounterEnded:!0}}},ge={id:"flee",name:"Flee",description:"Attempt to escape from combat.",tickCost:150,tags:["combat","defensive"],execute:(t,e)=>{if(!(e!=null&&e.encounter))return{success:!1,message:"Nothing to flee from."};const n=e.encounter.enemy,s=m(t),a=m(n),r=s/a,i=Math.min(.9,.4*r);return Math.random()<i?{success:!0,message:`You turn and run from the ${n.name}!`,fled:!0}:{success:!0,message:`You try to flee but the ${n.name} blocks your escape!`,fled:!1}}},pe={id:"chase",name:"Chase",description:"Pursue a fleeing enemy.",tickCost:250,tags:["combat","offensive"],execute:(t,e)=>{if(!(e!=null&&e.encounter))return{success:!1,message:"Nothing to chase."};if(!e.encounter.enemyFleeing)return{success:!1,message:"The enemy is not fleeing."};const n=e.encounter.enemy,s=m(t),a=m(n),r=s/a,i=Math.min(.85,.5*r);return Math.random()<i?(e.encounter.enemyFleeing=!1,{success:!0,message:`You catch up to the fleeing ${n.name}!`}):{success:!0,message:`The ${n.name} escapes into the distance.`,encounterEnded:!0}}},ye={id:"let-go",name:"Let Go",description:"Allow the enemy to escape.",tickCost:50,tags:["combat"],execute:(t,e)=>e!=null&&e.encounter?{success:!0,message:`You let the ${e.encounter.enemy.name} flee.`,encounterEnded:!0}:{success:!1,message:"Nothing to let go."}},ke=[fe,ge,pe,ye],ve=[oe,ie,ce],Ce=[ue,le],be=[me,he,de],Me=[ae,re,...ke,...ve,...Ce,...be],Ee=1e4,Se=100,Ae=100,we=15;function $e(){return O("player","Player",{maxTicks:Ee,speed:Se,maxHealth:Ae,damage:we,actions:Me})}const E=[{id:"wolf",name:"Wolf",maxHealth:60,damage:12,speed:120,fleeThreshold:.3,aggressiveness:.6,loot:{rawMeat:{min:1,max:2,chance:.9}}},{id:"boar",name:"Wild Boar",maxHealth:80,damage:15,speed:90,fleeThreshold:.2,aggressiveness:.8,loot:{rawMeat:{min:2,max:4,chance:1}}},{id:"snake",name:"Venomous Snake",maxHealth:30,damage:20,speed:140,fleeThreshold:.5,aggressiveness:.4,loot:{rawMeat:{min:1,max:1,chance:.5}}},{id:"bandit",name:"Bandit",maxHealth:70,damage:14,speed:100,fleeThreshold:.25,aggressiveness:.5,loot:{},usesInventory:!0}];function Le(){const t={};return Math.random()<.5&&(t.berries=Math.floor(Math.random()*4)+1),Math.random()<.6&&(t.sticks=Math.floor(Math.random()*3)+1),Math.random()<.4&&(t.rocks=Math.floor(Math.random()*2)+1),Math.random()<.3&&(t.rawMeat=Math.floor(Math.random()*2)+1),Math.random()<.2&&(t.cookedMeat=1),t}function Ie(t){const e=t.usesInventory?Le():{};return O(t.id,t.name,{maxHealth:t.maxHealth,damage:t.damage,speed:t.speed,maxTicks:5e3,inventory:e,actions:[]})}function Te(t){const e=A(t);if(!e)return{};if(e.usesInventory)return{...t.inventory};const n={};for(const[s,a]of Object.entries(e.loot))if(Math.random()<a.chance){const r=Math.floor(Math.random()*(a.max-a.min+1))+a.min;n[s]=r}return n}function Oe(){const t=E[Math.floor(Math.random()*E.length)];return Ie(t)}function A(t){return E.find(e=>e.id===t.id)}function He(t){return{enemy:t??Oe(),playerFleeing:!1,enemyFleeing:!1,ended:!1}}function g(t,e){t.ended=!0,t.result=e}function xe(t,e){const n=t.enemy,s=A(n);if(t.playerFleeing)return Pe(t,e);if(t.enemyFleeing)return Ye(t,e);const a=n.health/n.maxHealth,r=(s==null?void 0:s.fleeThreshold)??.3,o=(s==null?void 0:s.aggressiveness)??.5;if(a<=r){const i=e.health/e.maxHealth,u=(1-o)*(1-i*.5);if(Math.random()<u)return Re(t)}return Be(t,e)}function Be(t,e){const n=t.enemy,s=n.damage;return k(e,s),f(e)?{type:"attack",message:`The ${n.name} strikes you for ${s} damage. (${e.health}/${e.maxHealth} HP)`,damage:s}:{type:"attack",message:`The ${n.name} strikes you for ${s} damage. You have been defeated!`,damage:s,encounterEnded:!0}}function Re(t){return t.enemyFleeing=!0,{type:"flee",message:`The ${t.enemy.name} turns to flee!`,fled:!1}}function Ye(t,e){const n=t.enemy,s=m(n),a=m(e),r=s/a,i=Math.min(.9,.4*r);return Math.random()<i?{type:"flee",message:`The ${n.name} escapes!`,fled:!0,encounterEnded:!0}:(t.enemyFleeing=!1,{type:"flee",message:`The ${n.name} fails to escape and turns to fight!`,fled:!1})}function Pe(t,e){const n=t.enemy,s=A(n),a=(s==null?void 0:s.aggressiveness)??.5,r=e.health/e.maxHealth,o=a+(1-r)*.3;if(Math.random()<o){const i=m(n),u=m(e),c=i/u,l=Math.min(.85,.5*c);return Math.random()<l?(t.playerFleeing=!1,{type:"chase",message:`The ${n.name} catches up to you!`}):{type:"chase",message:`The ${n.name} chases but you escape!`,encounterEnded:!0}}return{type:"chase",message:`The ${n.name} lets you flee.`,encounterEnded:!0}}function _e(t,e){const n=t.enemy,s=n.speed*2;M(n,s);const a=200;return n.ticks<a?null:(n.ticks-=a,xe(t,e))}function Ge(t,e,n){e.fled===!0&&(t.playerFleeing=!0),e.encounterEnded&&(f(t.enemy)?t.playerFleeing||e.fled?g(t,"player_escaped"):t.enemyFleeing&&g(t,"enemy_escaped"):g(t,"victory"))}const L=2,Ne=1,I=500,T=10;class Fe{constructor(){p(this,"state");p(this,"listeners",new Map);this.state=this.createInitialState()}createInitialState(){return{player:$e(),turn:0,log:[],encounter:null,availableNodes:new Set,structures:new Set,gameOver:!1}}restart(){this.state=this.createInitialState(),this.log("A new journey begins..."),this.emit("turn")}start(){this.log("Welcome to Iterra.")}performAction(e){if(this.state.gameOver)return!1;const n=this.state.player;if(this.state.encounter&&e.tags.includes("non-combat"))return this.log(`Cannot ${e.name.toLowerCase()} during an encounter!`),!1;if(!this.state.encounter&&e.tags.includes("combat"))return this.log(`No enemy to ${e.name.toLowerCase()}.`),!1;if(!b(n,e))return this.log(`Not enough ticks for ${e.name}. Need ${e.tickCost}, have ${n.ticks}.`),!1;W(n,e.tickCost),e.tickGain&&M(n,e.tickGain);const s={encounter:this.state.encounter??void 0,game:this.state},a=e.execute(n,s);return this.state.turn++,this.log(a.message),a.foundResource&&this.state.availableNodes.add(a.foundResource),e.tags.includes("gathering")&&this.processResourceDepletion(e.id),this.state.encounter?(Ge(this.state.encounter,a),this.state.encounter.ended?this.endCurrentEncounter():this.processEnemyTurns()):e.id==="wander"&&!a.foundResource&&this.checkForEncounter(),this.processRegen(),this.processStarvation(),this.processPassOut(),this.emit("turn"),!0}processRegen(){const e=this.state.player;z(e)&&e.health<e.maxHealth&&(U(e,L),V(e,Ne),this.log(`You feel restored. (+${L} HP, ${e.health}/${e.maxHealth})`))}processStarvation(){const e=this.state.player;if(x(e)){const n=J(e);k(e,n),this.log(`You are starving! (-${n} HP, ${e.health}/${e.maxHealth})`),f(e)||(this.log("You have starved to death..."),this.triggerGameOver())}}canAffordAnyAction(){const e=this.getAvailableActions(),n=this.state.player;return e.some(s=>b(n,s))}processPassOut(){if(this.state.gameOver||this.canAffordAnyAction())return;const e=this.state.player;if(this.log("You collapse from exhaustion..."),k(e,T),M(e,I),this.state.turn++,this.log(`You wake up weakened. (-${T} HP, +${I} ticks)`),!f(e)){this.log("You never wake up..."),this.triggerGameOver();return}this.state.encounter&&!this.state.encounter.ended&&(this.log(`The ${this.state.encounter.enemy.name} attacks while you're vulnerable!`),this.processEnemyTurns()),this.emit("turn")}triggerGameOver(){this.state.gameOver=!0,this.log("GAME OVER"),this.emit("game-over")}processResourceDepletion(e){const s={"gather-berries":"berryBush","gather-sticks":"fallenBranches","gather-rocks":"rockyOutcrop"}[e];if(!s)return;const a=ee(s);a&&Math.random()<a.depletionChance&&(this.state.availableNodes.delete(s),this.log(`The ${a.name.toLowerCase()} is now depleted.`))}checkForEncounter(){Math.random()<.2&&this.startEncounter()}startEncounter(e){const n=He(e);this.state.encounter=n,this.log(`A wild ${n.enemy.name} appears!`),this.emit("encounter-start")}processEnemyTurns(){if(!this.state.encounter||this.state.encounter.ended)return;const e=this.state.encounter,n=this.state.player,s=_e(e,n);s&&(this.log(s.message),s.encounterEnded&&(f(n)?s.fled?g(e,"enemy_escaped"):e.playerFleeing&&g(e,"player_escaped"):g(e,"defeat"),this.endCurrentEncounter()))}endCurrentEncounter(){if(!this.state.encounter)return;const e=this.state.encounter.result,n=this.state.encounter.enemy;switch(e){case"victory":this.log(`You defeated the ${n.name}!`),this.grantLoot(n);break;case"defeat":this.log("You have been defeated..."),this.state.encounter=null,this.triggerGameOver();return;case"player_escaped":this.log("You escaped safely.");break;case"enemy_escaped":this.log(`The ${n.name} got away.`);break}this.state.encounter=null,this.emit("encounter-end")}grantLoot(e){const n=Te(e),s=this.state.player,a=[];for(const[r,o]of Object.entries(n))if(o>0){C(s,r,o);const i=v(r),u=(i==null?void 0:i.name)??r;a.push(`${o} ${u}`)}a.length>0&&this.log(`Loot: ${a.join(", ")}`)}log(e){const n={turn:this.state.turn,message:e};this.state.log.unshift(n),this.state.log.length>100&&this.state.log.pop(),this.emit("log")}on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n)}off(e,n){var s;(s=this.listeners.get(e))==null||s.delete(n)}emit(e){var n;(n=this.listeners.get(e))==null||n.forEach(s=>s(this))}getAvailableActions(){var u;const e=this.state.player.actions,n=this.state.encounter!==null,s=((u=this.state.encounter)==null?void 0:u.enemyFleeing)??!1,a=this.state.player,r={"gather-berries":"berryBush","gather-sticks":"fallenBranches","gather-rocks":"rockyOutcrop"},o={"eat-berries":"berries","eat-cooked-meat":"cookedMeat","eat-raw-meat":"rawMeat"},i={"cook-meat":{requiresCampfire:!0,requiresItems:{rawMeat:1}},"build-campfire":{requiresItems:{sticks:5,rocks:3}}};return e.filter(c=>{var $;if(n&&c.tags.includes("non-combat")||!n&&c.tags.includes("combat")||c.id==="chase"&&!s||c.id==="let-go"&&!s||c.id==="flee"&&(($=this.state.encounter)!=null&&$.playerFleeing))return!1;const l=r[c.id];if(l&&!this.state.availableNodes.has(l))return!1;const h=o[c.id];if(h&&d(a,h)<=0)return!1;const y=i[c.id];if(y){if(y.requiresCampfire&&!this.state.structures.has("campfire"))return!1;if(y.requiresItems){for(const[N,F]of Object.entries(y.requiresItems))if(d(a,N)<F)return!1}}return!(c.id==="build-campfire"&&this.state.structures.has("campfire"))})}filterActions(e){const n=this.getAvailableActions(),s=e.toLowerCase().trim();return s?n.filter(a=>{const r=a.name.toLowerCase().includes(s),o=a.description.toLowerCase().includes(s),i=a.tags.some(u=>u.toLowerCase().includes(s));return r||o||i}):n}}class qe{constructor(e){p(this,"game");p(this,"elements");this.game=e,this.elements={tickCount:document.getElementById("tick-count"),turnCount:document.getElementById("turn-count"),healthCount:document.getElementById("health-count"),maxHealth:document.getElementById("max-health"),saturationCount:document.getElementById("saturation-count"),maxSaturation:document.getElementById("max-saturation"),weightCount:document.getElementById("weight-count"),maxWeight:document.getElementById("max-weight"),inventoryList:document.getElementById("inventory-list"),structuresPanel:document.getElementById("structures-panel"),structuresList:document.getElementById("structures-list"),actionSearch:document.getElementById("action-search"),actionsList:document.getElementById("actions-list"),gameLog:document.getElementById("game-log"),encounterPanel:document.getElementById("encounter-panel"),enemyName:document.getElementById("enemy-name"),enemyHealth:document.getElementById("enemy-health"),enemyMaxHealth:document.getElementById("enemy-max-health"),encounterStatus:document.getElementById("encounter-status"),gameOverPanel:document.getElementById("game-over-panel"),restartButton:document.getElementById("restart-button")},this.setupEventListeners(),this.subscribeToGame()}setupEventListeners(){this.elements.actionSearch.addEventListener("input",()=>{this.renderActions()}),this.elements.restartButton.addEventListener("click",()=>{this.game.restart(),this.elements.gameOverPanel.classList.add("hidden"),this.render()}),document.addEventListener("keydown",e=>{e.key==="/"&&document.activeElement!==this.elements.actionSearch&&(e.preventDefault(),this.elements.actionSearch.focus()),e.key==="Escape"&&(this.elements.actionSearch.blur(),this.elements.actionSearch.value="",this.renderActions())})}subscribeToGame(){this.game.on("turn",()=>{this.renderStatus(),this.renderInventory(),this.renderStructures(),this.renderEncounter(),this.renderActions()}),this.game.on("log",()=>this.renderLog()),this.game.on("encounter-start",()=>{this.renderEncounter(),this.renderActions()}),this.game.on("encounter-end",()=>{this.renderEncounter(),this.renderActions()}),this.game.on("game-over",()=>{this.renderGameOver()})}renderGameOver(){this.elements.gameOverPanel.classList.remove("hidden")}render(){this.renderStatus(),this.renderInventory(),this.renderStructures(),this.renderEncounter(),this.renderActions(),this.renderLog()}renderStatus(){const e=this.game.state.player;this.elements.tickCount.textContent=e.ticks.toString(),this.elements.turnCount.textContent=this.game.state.turn.toString(),this.elements.healthCount.textContent=e.health.toString(),this.elements.maxHealth.textContent=e.maxHealth.toString(),this.elements.saturationCount.textContent=e.saturation.toString(),this.elements.maxSaturation.textContent=e.maxSaturation.toString();const n=B(e),s=R(e),a=s>0?"+":"";this.elements.weightCount.textContent=n.toFixed(1),this.elements.maxWeight.textContent=`${e.carryCapacity} (${a}${Math.round(s)} spd)`}renderInventory(){const n=this.game.state.player.inventory,s=Object.entries(n).filter(([a,r])=>r>0).map(([a,r])=>{const o=v(a);return`<span class="inventory-item">${(o==null?void 0:o.name)??a}: <span class="item-count">${r}</span></span>`});s.length===0?this.elements.inventoryList.innerHTML='<span class="inventory-empty">Empty</span>':this.elements.inventoryList.innerHTML=s.join("")}renderStructures(){const e=this.game.state.structures;if(e.size===0){this.elements.structuresPanel.classList.add("hidden");return}this.elements.structuresPanel.classList.remove("hidden");const n={campfire:"Campfire"},s=Array.from(e).map(a=>`<span class="structure-item">${n[a]??a}</span>`);this.elements.structuresList.innerHTML=s.join("")}renderEncounter(){const e=this.game.state.encounter;if(!e){this.elements.encounterPanel.classList.add("hidden");return}this.elements.encounterPanel.classList.remove("hidden");const n=e.enemy;this.elements.enemyName.textContent=n.name,this.elements.enemyHealth.textContent=n.health.toString(),this.elements.enemyMaxHealth.textContent=n.maxHealth.toString();let s="";e.enemyFleeing?s="Enemy is fleeing!":e.playerFleeing&&(s="You are fleeing!"),this.elements.encounterStatus.textContent=s}renderActions(){const e=this.elements.actionSearch.value,n=this.game.filterActions(e);this.elements.actionsList.innerHTML=n.map(s=>this.renderActionItem(s)).join(""),this.elements.actionsList.querySelectorAll(".action-item").forEach(s=>{const a=s.getAttribute("data-action-id"),r=n.find(o=>o.id===a);r&&s.addEventListener("click",()=>this.handleActionClick(r))})}renderActionItem(e){const n=this.game.state.player,s=b(n,e);let a;if(e.tickGain&&e.tickCost){const r=e.tickGain-e.tickCost;a=`${e.tickCost} cost, +${r} net`}else e.tickGain?a=`+${e.tickGain} ticks`:a=`${e.tickCost} ticks`;return`
      <div class="action-item ${s?"":"disabled"}" data-action-id="${e.id}">
        <div class="action-info">
          <span class="action-name">${e.name}</span>
        </div>
        <span class="action-cost ${s?"affordable":""}">${a}</span>
      </div>
    `}handleActionClick(e){this.game.performAction(e)}renderLog(){const e=this.game.state.log.slice(0,20);this.elements.gameLog.innerHTML=e.map(n=>`
        <div class="log-entry">
          <span class="timestamp">[${n.turn}]</span>
          ${n.message}
        </div>
      `).join("")}}const w=new Fe,je=new qe(w);je.render();w.start();window.game=w;
