var m=Object.defineProperty;var h=(n,t,e)=>t in n?m(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>h(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function g(n,t,e={}){const{maxTicks:s=100,tickRegenRate:i=0,actions:r=[]}=e;return{id:n,name:t,ticks:s,maxTicks:s,tickRegenRate:i,actions:[...r],currentAction:null,actionProgress:0}}function d(n,t){return n.ticks>=t.tickCost}function f(n,t){n.ticks=Math.min(n.ticks+t,n.maxTicks)}function p(n,t){return n.ticks<t?!1:(n.ticks-=t,!0)}const k={id:"idle",name:"Idle",description:"Do nothing and let time pass.",tickCost:1,tags:["basic","passive"],execute:n=>({success:!0,message:"You idle, letting time slip by."})},A={id:"wander",name:"Wander",description:"Wander aimlessly, perhaps discovering something.",tickCost:3,tags:["basic","exploration","movement"],execute:n=>{const t=["You wander through familiar paths.","You explore a quiet corner.","You meander without purpose, but feel refreshed.","Your wandering reveals nothing new, but clears your mind."];return{success:!0,message:t[Math.floor(Math.random()*t.length)]}}},y=[k,A],v=100,L=1;function T(){return g("player","Player",{maxTicks:v,tickRegenRate:L,actions:y})}class w{constructor(){c(this,"state");c(this,"listeners",new Map);c(this,"tickInterval",null);c(this,"lastTickTime",0);this.state={player:T(),turn:0,log:[]}}start(){this.log("Welcome to Iterra."),this.lastTickTime=performance.now(),this.tickInterval=window.setInterval(()=>this.tick(),100)}stop(){this.tickInterval!==null&&(clearInterval(this.tickInterval),this.tickInterval=null)}tick(){const t=performance.now(),e=(t-this.lastTickTime)/1e3;this.lastTickTime=t;const s=this.state.player;if(s.tickRegenRate>0){const i=s.tickRegenRate*e;f(s,i)}if(s.currentAction){s.actionProgress+=e;const i=s.currentAction.tickCost*.5;s.actionProgress>=i&&this.completeAction()}this.emit("tick")}selectAction(t){const e=this.state.player;return e.currentAction?!1:d(e,t)?p(e,t.tickCost)?(e.currentAction=t,e.actionProgress=0,this.emit("action-start"),!0):!1:(this.log(`Not enough ticks for ${t.name}. Need ${t.tickCost}, have ${Math.floor(e.ticks)}.`),!1)}completeAction(){const t=this.state.player,e=t.currentAction;if(!e)return;const s=e.execute(t);this.state.turn++,this.log(s.message),t.currentAction=null,t.actionProgress=0,this.emit("action-complete")}log(t){const e={turn:this.state.turn,message:t,timestamp:Date.now()};this.state.log.unshift(e),this.state.log.length>100&&this.state.log.pop(),this.emit("log")}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){var s;(s=this.listeners.get(t))==null||s.delete(e)}emit(t){var e;(e=this.listeners.get(t))==null||e.forEach(s=>s(this))}getAvailableActions(){return this.state.player.actions}filterActions(t){const e=t.toLowerCase().trim();return e?this.getAvailableActions().filter(s=>{const i=s.name.toLowerCase().includes(e),r=s.description.toLowerCase().includes(e),o=s.tags.some(a=>a.toLowerCase().includes(e));return i||r||o}):this.getAvailableActions()}}class I{constructor(t){c(this,"game");c(this,"elements");this.game=t,this.elements={tickCount:document.getElementById("tick-count"),tickRate:document.getElementById("tick-rate"),currentAction:document.getElementById("current-action"),actionProgress:document.getElementById("action-progress"),actionSearch:document.getElementById("action-search"),actionsList:document.getElementById("actions-list"),gameLog:document.getElementById("game-log")},this.setupEventListeners(),this.subscribeToGame()}setupEventListeners(){this.elements.actionSearch.addEventListener("input",()=>{this.renderActions()}),document.addEventListener("keydown",t=>{t.key==="/"&&document.activeElement!==this.elements.actionSearch&&(t.preventDefault(),this.elements.actionSearch.focus()),t.key==="Escape"&&(this.elements.actionSearch.blur(),this.elements.actionSearch.value="",this.renderActions())})}subscribeToGame(){this.game.on("tick",()=>this.renderTicks()),this.game.on("action-start",()=>{this.renderStatus(),this.renderActions()}),this.game.on("action-complete",()=>{this.renderStatus(),this.renderActions()}),this.game.on("log",()=>this.renderLog())}render(){this.renderTicks(),this.renderStatus(),this.renderActions(),this.renderLog()}renderTicks(){const t=this.game.state.player;this.elements.tickCount.textContent=Math.floor(t.ticks).toString(),this.elements.tickRate.textContent=t.tickRegenRate.toString(),this.renderActions(),this.renderStatus()}renderStatus(){const t=this.game.state.player;if(t.currentAction){this.elements.currentAction.textContent=t.currentAction.name;const e=t.currentAction.tickCost*.5,s=Math.min(t.actionProgress/e*100,100);this.elements.actionProgress.innerHTML=`<div class="bar" style="width: ${s}%"></div>`}else this.elements.currentAction.textContent="Idle",this.elements.actionProgress.innerHTML=""}renderActions(){const t=this.elements.actionSearch.value,e=this.game.filterActions(t),i=this.game.state.player.currentAction!==null;this.elements.actionsList.innerHTML=e.map(r=>this.renderActionItem(r,i)).join(""),this.elements.actionsList.querySelectorAll(".action-item").forEach(r=>{const o=r.getAttribute("data-action-id"),a=e.find(u=>u.id===o);a&&r.addEventListener("click",()=>this.handleActionClick(a))})}renderActionItem(t,e){const s=this.game.state.player,i=d(s,t);return`
      <div class="action-item ${!i||e?"disabled":""}" data-action-id="${t.id}">
        <div class="action-info">
          <span class="action-name">${t.name}</span>
        </div>
        <span class="action-cost ${i?"affordable":""}">${t.tickCost} ticks</span>
      </div>
    `}handleActionClick(t){this.game.selectAction(t)}renderLog(){const t=this.game.state.log.slice(0,20);this.elements.gameLog.innerHTML=t.map(e=>`
          <div class="log-entry">
            <span class="timestamp">[${new Date(e.timestamp).toLocaleTimeString()}]</span>
            ${e.message}
          </div>
        `).join("")}}const l=new w,b=new I(l);b.render();l.start();window.game=l;
